# 《设计模式的艺术》第2章学习笔记

## 第2章 预备知识——UML类图与面向对象设计原则

### UML

1. UML（Unified Modeling Language，统一建模语言）
    - 统一表示，方便交流
    - 通用的可视化建模语言，用图形符号表达
    - 用于对软件进行描述、可视化处理、构造和建立软件系统相关文档

2. 类的UML图示
    - 类使用包含类名、属性和操作且带有分割线的长方形来表示
    - 属性的表示方式：`可见性 名称:类型 [ = 默认值 ]`，其中“可见性”可以是public，private和protected，分别用符合+, -, #来表示
    - 操作的表示方式`可见性 名称(参数列表) [ : 返回类型 ]`

3. 类之间的关系
    - 关联关系：通常将一个类的对象作为另一个类的成员变量。***实线连接、关联线上标注角色名或用动词表示两者关系（如contains、purchases）***
        - 双向关联：默认情况下，关联是双向的。***实线，无箭头***
        - 单向关联：***实线，单向箭头***
        - 自关联：***实线，单向箭头，指向自己***
        - 多重性关联：表示两个关联对象在数量上的对应关系
        - 聚合关系：表示整体与部分的关系。在聚合关系中，成员对象是整体对象的一部分，但是成员对象可以脱离整体对象独立存在。***用带空心菱形的、带箭头的直线表示***。
        - 组合关系：也表示整体与部分的关系。在组合关系中，整体对象可以控制成员对象的生命周期，一旦整体对象不存在，成员对象也将不存在。***用带实心菱形的、带箭头的直线表示***。
    - 依赖关系：一种使用关系。***用带箭头的虚线表示。***
    - 泛化关系：也就是继承关系。***用带空心三角形的直线来表示。***
    - 接口与实现关系：***用带空心三角形的虚线来表示。***

### 面向对象设计原则

1. 7种常用的***面向对象设计原则***
    - 单一职责原则（Single Responsibility Principle, SRP）：一个类只负责一个功能领域中的相应职责
    - 开闭原则（Open-Closed Principle, OCP）：软件实体应对扩展开放，而对修改关闭
    - 里氏代换原则（Liskov Substitution Principle, LSP）：所有引用基类（父类）对象的地方能够透明地使用其子类的对象
    - 依赖倒转原则（Dependence Inversion Principle, DIP）：抽象不应该依赖于细节，细节应该依赖于抽象
    - 接口隔离原则（Interface Segregation Principle, ISP）：使用多个专门的接口，而不应该使用单一的总接口
    - 合成复用原则（Composite Reuse Principle, CRP）：尽量使用对象组合，而不是继承来达到复用的目的
    - 迪米特法则（Law of Demeter, LoD）：一个软件实体应当尽可能少地与其他实体发生相互作用

> 疑问：每一个原则提出的原因是什么？

2. 单一职责原则
    - 一个类承担的职责越多，它被复用的可能性就越小
    - 一个类承担的职责过多，就相当于将这些职责耦合在一起，当其中一个职责变化时，可能会影响其他职责的运作
    - 如果多个职责总是同时发生改变则可将它们封装在同一个类中
    - ***单一职责原则是实现高内聚、低耦合的指导方针***

3. 开闭原则
    - 开闭原则是指***软件实体应尽量在不修改原有代码的情况下进行扩展***
    - 抽象化是开闭原则的关键。可以为系统定义一个相对稳定的抽象层，而将不同的实现行为移至具体的实现层中完成。

4. 里氏代换原则
    - 里氏代换原则表明，在软件中将一个基类对象替换成它的子类对象，程序将不会产生任何错误和异常，反过来则不成立
    - 由于使用基类对象的地方都可以使用子类对象，因此***在程序中尽量使用基类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象***

5. 依赖倒转原则
    - 依赖倒转原则要求在程序代码中传递参数时或在关联关系中，尽量引用层次高的抽象层类，即使用接口和抽象类进行变量类型声明、参数类型声明、方法类型声明，以及数据类型的转换，而不要用具体类来做这些事情。
    - 为确保该原则的应用，一个具体类应该只实现接口或抽象类中声明的方法，而不要给出多余的方法，否则将无法调用到在子类中增加的新方法。
    - ***在程序中尽量使用抽象层进行编程，而将具体类写在配置文件中***。这样，如果系统行为发生变化，只需对抽象层进行扩展，并修改配置文件即可
    - 在实现依赖倒转原则时，需要针对抽象层编程，而将具体类的对象通过依赖注入的方式注入到其他对象中。常用的注入方式有3种
        - 构造注入：通过构造函数来传入具体类的对象
        - 设值注入：通过Setter方法来传入具体类的对象
        - 接口注入：通过实现在接口中声明的业务方法来传入具体类的对象

6. 接口隔离原则
    - 在面向对象编程语言中，实现一个接口就需要实现该接口中定义的所有方法，因此大的总接口使用起来不一定很方便。为了使接口的职责单一，需要将大接口中的方法根据其职责不同分别放在不同的小接口中，以确保每个接口使用起来都很方便。
    - 在使用接口隔离原则时，需要注意控制接口的粒度。接口不能太小，否则会导致系统中接口泛滥，不利于维护；接口也不能太大，否则灵活性较差，使用起来很不方便。一般而言，接口中包含为某一类用户定制的方法即可。

7. 合成复用原则
    - 又称为组合/聚合复用原则（Composition/ Aggregate Reuse Principle）
    - 组合/聚合可以使系统更加灵活，降低类与类之间的耦合度，一个类的变化对其他类造成的影响相对较少
    - 继承复用的主要问题在于会破坏系统的封装性。因为继承会将基类的实现细节暴露给子类，如果基类发生改变，那么子类的实现也不得不发生改变。这种复用又称为“白箱”复用
    - 合成复用中，成员对象的实现细节对于新对象不可见，这种复用被称为“黑箱”复用
    - 一般而言，***如果两个类之间是“Has-A”的关系，应使用组合或聚合，如果是“Is-A”关系，可使用继承。***

8. 迪米特法则
    - 如果一个系统符合迪米特法则，那么当其中某一个模块发生修改后，就会尽量少地影响其他模块，扩展会相对容易。
    - 这是对软件实体之间通信的宽度和深度作了限制，可以降低系统的耦合度，使类与类之间保持松散的耦合关系。
    - 迪米特发展要求***在设计系统时，应该尽量减少对象之间的交互。如果两个对象之间不必彼此直接通信，那么这两个对象就不应当发生任何直接的相互作用；如果其中一个对象需要调用另一个对象的方法，可以通过第三者转发这个调用。***
    - 在类的结构设计上，***每一个类都应当尽量降低其成员变量和成员函数的访问权限；只要有可能，一个类型应当设计成不变类；在对其他类的引用上，一个对象对其他对象的引用应当降到最低。***
