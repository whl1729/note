# 《软件调试的艺术》读书笔记

## 1 预备知识

1. 调试的原则
    - 调试的本质（基本原则）：逐个确认，你自认为正确的许多事情所对应的代码确实是正确的。当你发现其中某个假设不成立时，就表示已经找到了关于程序错误所在位置的线索。（伍注：注意是***逐个确认***，即使是你很有把握认为没问题的函数或变量，都要确认。）
    - 使用调试工具可以减少所花费的时间和需要忍受的厌烦感。
    - 从简单工作开始调试。在调试过程的开始阶段，应该从容易、简单的情况开始运行程序。这样做也许无法揭示所有的程序错误，但很有可能发现其中的部分错误。
    - 使用自顶向下的方法来调试代码。在遇到函数调用时，先通过`next`执行调用，然后检查依赖于调用结果的变量的值，从而了解该函数是否正确运行。如果正确，就可以避免单步调试函数中代码这样既浪费时间又不必要的工作。
    - 使用调试工具确定段错误的位置。
    - 通过发出中断确定无限循环的位置。
    - 使用二分搜索。

2. 主要调试器操作
    - 单步调试源代码
        - 断点 `break line_no`
        - 单步调试 `next`和`step`
        - 恢复操作 `continue`
        - 临时断点 `tbreak`，`until`和`finish`
    - 检查变量
        - `print`
        - `display`
    - 设置监视点以应对变量值的改变
        - `watch x` 每当x的值发生变化，gdb都会暂停执行
        - `watch (x > 28)` 基于条件表达式来设置监视点
    - 上下移动调用栈
        - `frame 1` 当执行gdb的frame命令时，当前正在执行的函数的帧被编号为0，其父帧被编号为1，父帧的父帧被编号为2，以此类推。
        - `up` 调用栈中的下一个父帧，`down` 调用栈中的上一个父帧
        - `backtrace`或`bt` 显示整个栈，即当前存在的所有帧的集合

3. 调试程序时，如果程序进入了死循环，可以按`Ctrl+C`挂起它，这时gdb会显示如下内容，可见`Ctrl+C`会使得gdb向进程发送SIGINT信号。有时最好挂起和重启几次，以便查看每次是在何处停止的。方法是在两次按下`Ctrl+C`之间执行continue命令。
```
(gdb) c
Continuing.
^C
Program received signal SIGINT, Interrupt.
0x00005555555547f7 in process_data () at 01_insert_sort.c:49
```

4. 调试过程中，可以用run命令重新运行程序，如果要重用老的命令行参数，就不必再次指定命令行参数。

5. 调试过程中，发现代码有bug后，不必退出gdb，在另一个窗口修改代码并重新编译程序，然后在gdb中用run命令重新运行程序即可。这样做提供了很大的方便：
    - 不需要重新指出命令行参数，只要键入run重新运行程序即可。
    - gdb保留了你设置的断点，因此不需要再次键入它。

6. 调试过程中，如果出现非法访问内存，则gdb会向进程发送SIGSEGV信号。
```
Program received signal SIGSEGV, Segmentation fault.
0x000055555555473c in scoot_over (jj=0) at 01_insert_sort.c:21
```
