# 在华为工作时写过的Bug

## 5 误删代码导致单板小APP功能概率性失效

- Bug发现时间：2018年8月14日
- Bug发现过程：同事开发新单板的小APP功能，发现某些环境后小APP自动加载失败。查看代码合入日志发现问题。
- Bug引入时间：2018年3月
- Bug引入过程：基于老代码开发新功能时，误以为老代码中第二次请求serdes参数是多余的，因此将其删除。然而第二次请求serdes参数是用来开自适应的，不开的话可能会影响serdes链路质量。由于问题是概率性出现的，我当时在自己的环境上验证通过了。转测试后，测试人员也没测出问题。后来别人环境上出现过小APP自动加载失败的情况，但换过槽位就好了，自己也没深究。
- 教训：
    - 修改老代码前一定要仔细阅读原代码、请教老代码作者，以确保自己理解原来的代码流程。
    - 发现问题后不能放过，要深入分析其原因。
    - 自己比较粗心，尤须通过规范开发流程来减少犯错。以后要严格规范落实代码设计、开发、自检、检视、自验、联调等流程。

## 4 漏改版本号信息导致H801ETHA单板自动加载失败

- Bug发现时间：2018年7月20日
- Bug发现过程：测试人员加载R18C10 GA版本，发现H801ETHA单板自动加载失败，查看代码合入日志发现问题。
- Bug引入时间：2017年12月
- Bug引入过程：H801ETHA单板修改版本号时需要修改6~7处地方，自己有3个地方没修改。代码上库后也没验证这个单板，估计认为修改版本号应该不会出问题，而且自动化环境也会验证（但实际上自动化环境并没有这块单板）。测试那边估计没没有这块单板，导致一直没发现问题。
- 教训：修改代码时一定要小心、代码上库前要自检和发别人检视，代码上库后要自验。

## 3 合错代码分支导致dopra版本没升级

- Bug发现时间：2018年7月9日
- Bug发现过程：同事在确认R19C00的单板Dopra版本号时，发现还是R18C10的版本。
- Bug引入时间：2017年5月10日
- Bug引入过程：我之前是在本地代码库的主干分支完成了Dopra版本升级，而上库前一天，单板代码库拉了新分支作为R19C00分支，我代码合入时忘记了这点，导致合错分支。由于当时我已投入另一个项目，所以合入代码后，我让同事关注一下Dopra升级后单板的启动情况，就没跟踪这件事了。我交接时没告诉同事应该通过调试命令查看dopra版本号来确认dopra是否升级成功，导致当时没发现问题。
- 教训：
    - 代码合入时要检查合入的代码库地址和分支是否正确
    - 代码合入后要取库上版本自验，而且要明确正确的验证方法，可以先在纸上写好验证思路。（书写可以帮助思考）

## 2 修改输入参数时没适配修改入参检查上界，导致部分端口的镜像功能不可用

- Bug发现时间：2018年5月21日
- Bug发现过程：测试人员测试1588端口镜像功能时发现NAED单板的7端口的镜像功能不可用
- Bug引入时间：2017年9月
- Bug引入过程：开发H901OGHK支持1588 slave特性时，根据澄清结果，需要对原来的端口镜像代码做修改：底层表项索引改用端口号代替通道号。因此，原来对通道号的校验，现在要修改为对端口号的校验。而我忘记修改这个地方。代码合入后也没仔细验证这个功能。而且这个问题需要在多核单板的副核端口上配置镜像时才能发现。因此当时没暴露出问题。
- 教训：
    - 修改代码需要仔细自检和发别人检视。
    - 代码上库后一定要充分自验。

## 1 NAT特性创建业务流资源时只申请没占用，导致在业务流满配场景下可能会冲突

- Bug发现时间：2017年
- Bug发现过程：同事检视NAT特性的代码时发现有问题
- Bug引入时间：2016年9月
- Bug出现原因：没认真阅读业务流的代码，没理解清楚业务流的申请流程：get_flowid之后还要use_flowid。编码完毕没验证过流满配的场景。导致问题一直没发现。
- 教训：
    - 使用老代码中的接口时一定先弄清楚其用法
    - 代码上库后一定要充分自验，尤其是大容量场景
