# 《JavaScript语言精髓与编程实践》读书笔记

## JavaScript简介

* JavaScript之父Brendan Eich曾说：“我们最初利用JavaScript的目的，是让客户端的应用不必从服务器重新加载页面即可回应用户的输入信息，并且提供一种功能强大的图形工具包给脚本编写者。”

* 1995年12月4日，Netscape在与Sun公司共同发布声明中首次使用“JavaScript”名字，称之为一种“面向企业网络和互联网的、开放的、跨平台的对象脚本语言”。可见最初的JavaScript在一定程度上是为了解决浏览器与服务器之间统一开发而实现的一种语言。

* JavaScript的三个发展方向：
    1. OO++。向更加丰富的面向对象特性发展，主要解决大型系统开发中所需要的复杂的对象层次结构、类库及框架。
    2. Functional++。增强函数式特性，因为函数式特性在解决许多问题时来得比结构化的、面向对象的语言更优雅有效，而且从语言角度来看，函数式更为“纯粹”。
    3. System++。为更好地应用于浏览器之外的开发场景和组织大型项目等，需要解决“JavaScript缺乏基础运行框架和运行库”的问题。

* JavaScript的多种含义：
    1. JavaScript脚本语言。由ECMAScript-262规范的一种语言。涵盖Core JavaScript、JScript、ActionScript等。
    2. 浏览器JavaScript。包括DOM、BOM模型等在内的对象体系，但不确指具体脚本环境，是目前JavaScript最为广泛的应用环境。
    3. Core JavaScript。也称SpiderMonkey JavaScript，主要指Netscape/Mozilla系列的浏览器环境中的JavaScript，是该语言的主要规范之一。
    4. JScript。仅指IE系列的浏览器环境中的JavaScript，是使用最广泛的一种JavaScript脚本语言实现和该语言主要规范之一。

## JavaScript语法

### 语法综述

* 语言中的标识符一般分为两类：一类用于命名语法（及类型），称为“语法关键字”；一类用于命名值（的存储位置），称为“变量”和“常量”。

* 从标识符的角度来说，“绑定”分为语法关键字与语法（语义）逻辑的绑定，以及变量与它所存储值的位置的绑定。语法关键字对逻辑的绑定的结果，是作用域的绑定；变量对位置的绑定的结果，则是变量生存周期的限定。

* “声明”的意义：约定变量的生存周期和逻辑的作用域。

* JavaScript引擎会在代码装入时先进行语法分析，如果语法分析通不过，整个脚本代码块都不执行；当语法分析通过后，才会执行这段脚本代码。若在执行过程中出错，那么同一代码上下文中、出错点之后的代码将不再执行。

### 变量和类型声明

#### 弱类型语言
JavaScript是弱类型语言，而不是无类型语言。所谓弱类型语言，只表明该语言在表达式运算中不强制校验运算元的数据类型，而并不表明该语言是否具有类型系统。

#### 变量的数据类型

* JavaScript有6种基本数据类型：
    1. undefined：未定义。值类型。未声明、或者声明过但未赋值的变量的值会是undefined。
    2. number：数值。值类型。除赋值操作外，只有数值与数值的运算结果是数值，一些函数/方法的返回值是数值。
    3. string：字符串。值类型。不能直接读取或修改字符串中的单一字符。
    4. boolean：布尔值。值类型。true/false。
    5. function：函数。引用类型。JavaScript的函数具有多重含义：函数、方法、构造器、类及函数对象等。
    6. object：对象。引用类型。基于原型继承的面向对象。（由于不具备对象系统的全部特性，JavaScript通常被称为基于对象而非面向对象的语言）。

* `typeof`运算可以获取任何变量或值的类型，并且以字符串形式返回上述6种类型值之一。

* 全等运算符`===`用来对值类型/引用类型的实际数据进行比较和检查。

#### 变量声明

* JavaScript变量声明有2种方法：显式声明和隐式声明。

* 显式声明一般指用关键字var进行的声明语句，此外还有函数中的函数名声明和异常捕获子句中声明的异常对象。
```
// 声明变量str
var str = 'shoot';
// for语句中声明变量n
for (var n in object) {}
// 声明函数foo
function foo() {}
// 异常捕获语句中声明异常对象ex
try {}
catch (ex) {}
```

* 隐式声明则发生在不使用关键字var的赋值语句中。注意：对于不使用var的赋值语句，如果变量未被声明，实际效果是先声明该变量并立即赋给值；如果变量已经声明过，则该语句为赋值语句。
```
var b = 100;
function foo() {
    a = 100;    // 调用foo()之前未声明a，因此这里隐式声明了a，初值为100
    b = 1000;   // 调用foo()之前已经声明b，因此这里是把b赋值为1000
}
foo();
```

* 在函数声明时，可以省略函数名，这时表示声明一个匿名函数。函数名后使用一对不能省略的“()”表示形式参数列表。你也可以不声明形式参数，这时可以在函数体内使用一个名为arguments的内部对象来存取调用时传入的实际参数。

#### 直接量

* 字符串直接量可以用一对双引号或单引号来表示。

* 转义符主要用于在字符串中包含控制字符，以及当前操作系统语言（及字符集）不能直接输入的字符，也可以用于字符串中嵌套引号（不过你总是可以在单引号声明的字符串中直接使用双引号，或者反过来在双引号中使用单引号）。

* 当反斜线字符“\”位于一行的末尾（其后立即是代码文本中的换行）时，也用于表示连续的字符串声明。在这种字符串表示法中也可以使用其他转义符，只要它们出现在文本行最后的“\”字符之前即可。注意：不能在这种表示的行末使用注释。

* “\0”表示NUL字符，在JavaScript中NUL字符是一个真实存在于字符序列中的字符。
```
str = '\0\0\0\0\0';
alert(str.length);    // 显示字符串长度为5，表明NUL字符在字符串中是真实存在的
```

* 当数值直接量以0x或0X开始，表明是十六进制数值；以0开始，表明是八进制数值；其他情况下是十进制数值。当一个直接量被识别为十进制整型数时，它内部的存放格式可能是浮点数，也可能是整型数，取决于不同引擎的实现。在位运算中，引擎总是以整型数的形式来运算。

### 表达式运算

表达式一般由运算符与运算元构成。运算元可以是直接量、变量、函数或方法的返回值等。但JavaScript也可以存在没有运算符的表达式，称为单值表达式。
表达式运算的本质在于求值，而非表达逻辑。表达式运算总有结果值——一个值类型或引用类型的数据，或者undefined。

#### 运算符

* JavaScript的运算符大多数是特殊符号，但也有少量单词形式的运算符：
    * typeof：取变量或值的类型
    * void：运算表达式并忽略值
    * new：创建指定类的对象实例
    * in：检查对象属性
    * instanceof：检查变量是否指定类的实例
    * delete：删除实例属性

* JavaScript的特殊作用的运算符：
    * `? :`  三目条件运算符
    * `()`   表达式分组和调整运算次序
    * `,`    多重求值，表达式顺序地连续执行

* JavaScript的运算符按结果值的分类：

分类     | 说明                     | 运算符示例      | 运算元     | 目标类型
-------- | ------------------------ | --------------- | ---------- | --------
数值运算 | 一般性的数值运算         | + - * / %       | number     | number
位运算   | 数值的位运算             | \~ & \| ^ << 等 | number     | number
逻辑运算 | 布尔值运算               | !  \|\|         | boolean    | boolean
逻辑运算 | 值逻辑运算               | && \|\|         | (运算元)   | (运算元)
字符运算 | （仅有）字符串连接       | +               | string     | string
等值检测 | 检测两个值是否相等       | == != ===等     | *          | boolean
赋值运算 | 一般赋值和复合赋值       | = +=等          | *          | *
函数调用 | （仅有）函数调用         | ()              | function   | *
对象     | 对象创建、存取、检查等   | . [] new        | object     |
其他     | 表达式运算、typeod运算等 | void typeof等   | (表达式等) | *

#### 单值表达式

单值表达式有值的含义，表达式的结果即是其值。主要包括：
* this引用
* 变量引用，即一个已声明的标识符
* 直接量，包括null、undefined、字符串、布尔值、数值、正则表达式

#### 基本表达式

ECMAScript 5th中将下面几种表达式与单值表达式一起称为基本表达式：
* 数值初始器/直接量，即[...]
* 对象初始器/直接量，即{...}
* 表达式分组运算，即(...)

#### 复合表达式

复合表达式由多个表达式连接构成。复合表达式在按照“从左至右”邻近关系运算的同时，也受到运算符的优先级的影响。由于有了默认次序、优先级次序和强制优先级，则表达式就存在算法的逻辑上的含义。但表达式运算的本质目的是求值，而非表达逻辑。

#### 数值运算

* 在位运算操作中，JavaScript强制运算目标为一个有符号的32位整型数：如果目标是非数值，则强制转换为数值；如果目标是浮点数，则会被取整。

#### 逻辑运算

* 一般而言，逻辑运算与布尔运算是等义的。其运算元和结果值都是布尔值。实际运用中，运算元可能非布尔值，这时编译器会进行类型转换。
```
// 无论curVar是什么类型，都将被“逻辑否”运算符转换为bool值进行运算
!curVar
```

* JavaScript中存在表达式结果类型不确定的逻辑运算：“逻辑或（||）”和“逻辑与（&&）”。这两种运算有以下特性：
    * 运算符“||”和“&&”既不改变运算元的数据类型，也不改变运算结果的数据类型。
    * 运算符会将运算元理解为布尔值，以进行布尔运算。
    * 运算过程支持布尔短路。（与普通布尔运算一样）
```
var str = 'hello';
var obj = {};
x = str || obj;  // 结果为str
y = str && obj;  // 结果为obj
```

#### 比较运算

##### 等值检测

* 等值检测的目的是判断两个变量是否相同或相等。JavaScript中用`==`测试相等，用`===`测试相同。

* “相等”的运算规则
    * 两个值类型比较：转换成相同数据类型的值进行“数据等值”比较。
    * 两个引用类型比较：比较引用的地址。
    * 值类型与引用类型比较：将引用类型的数据转换为值类型数据相同的数据，再进行“数据等值”比较。

* “相同”的运算规则
    * 两个值类型比较：数据类型不同，则必然“不相同”；数据类型相同时，进行“数值等值”比较。
    * 两个引用类型比较：比较引用的地址。
    * 值类型与引用类型比较：必然“不相同”。

##### 序列检测

* JavaScript中可进行序列检测的数据类型：boolean，string和number。

* 序列检测的运算规则
    * 两个值类型比较：直接比较数据在序列中的大小。
    * 两个引用类型比较：无意义，总是返回false。
    * 值类型与引用类型比较：将引用类型的数据转换为值类型数据相同的数据，再进行“序列大小”比较。

* 值NaN没有序列值，任何值与NaN进行序列检测将得到false。

* 字符串与非字符串比较，会将字符串转换为数值再进行比较。如果字符串转换为数值时得到NaN，则结果为false。

#### 赋值运算

* JavaScript里有两种赋值运算符：一般赋值运算符，即=；带操作的赋值运算符，如 -=， >>=等。

* JavaScript中赋值是一个运算，而不是一个语句。所以在赋值表达式中，运算符左右都是运算元。按照“表达式”的概念，表达式的运算元可以是值（包括立即值）或引用。因此从语法上来说，`100 = 1000;`这句代码是成立的，在JavaScript中可以通过语法检测，但会触发一个执行期错误。这是因为左侧的运算元是直接量，其存储单元不可写。可见：“赋值运算”的本质是“修改存储单元的值”。

* 值类型的字符串是一个大的、不确定长度的连续数据块，这导致复制数据的开销很大。因此JavaScript中将字符串的赋值变成了复制（连续数据块起始处的）地址，即该字符串的地址引用。由此引入了三条字符串处理的限制：
    * 不能直接修改字符串中的字符。
    * 不能改变字符串的长短，例如修改length属性是无意义的。
    * 字符串连接运算必然导致写复制，这将产生新的字符串。

#### 运算优先级

优先级 | 运算符                        | 描述
------ | ----------------------------- | ---------------------------------------
1      | . [] ()                       | 对象成员存取、数组下标、函数调用等
2      | ++ - ~ delete new typeof void | 一元运算符等
3      | * / %                         | 乘法、除法、取模
4      | + -                           | 加法、减法、字符串连接
5      | << >> >>>                     | 移位
6      | < <= > >= instanceof          | 序列检测、instanceof
7      | == != === !==                 | 等值检测
8      | &                             | 按位与
9      | ^                             | 按位异或
10     | \|                            | 按位或
11     | &&                            | 逻辑与
12     | \|\|                          | 逻辑或
13     | ?:                            | 条件
14     | = OP=                         | 赋值、运算赋值
15     | ,                             | 逗号运算符，多重求值


